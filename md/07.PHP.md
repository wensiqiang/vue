# PHP笔记

> ### PHP概述

个人主页：超文本预处理语言（Personal Home Page : Hypertext Preprocessor , PHP）

- PHP的应用领域：
  1. Web网页程序：如动态网站、浏览器/服务器结构（Browser/Server , B/S）应用程序
  2. 命令行程序：如用户自定义批处理程序、Windows平台下的DOS程序
  3. 桌面应用程序：编写具有图形界面的桌面应用程序

- PHP具有如下<font color="red">特点与优势</font>：
  1. **免费开源**：用户可以免费使用PHP进行程序开发，并且PHP开放源代码，所有的PHP自身程序代码都可以被免费使用、学习和交流。
  2. **支持跨平台**：同一个PHP应用程序，无需修改源代码就可以在Windows、Linux、UNIX等操作系统中运行。
  3. **简单易学**：PHP继承了C语言的特点，并结合面向对象的编程思想。PHP的语法结构简单，且内置丰富的函数。
  4. **执行效率高**：PHP消耗更少的系统资源，服务器除了承担程序解释负荷外，无须承担其他负荷，执行速度比ASP和JSP更快，而且性能稳定。
  5. **支持面向对象**：面向对象编程是当今软件开发的发展趋势，PHP支持面向对象编程，对于提高PHP编程能力和规划好Web开发结构非常有意义。
  6. **高安全性**：PHP是公认的高安全性编程语言。因为PHP自身开源，所有人都可以对PHP代码进行研究，进而尽可能多地发现其存在的问题和错误，并及时修正。

- PHP的<font color="red">工作原理</font>：
  PHP是基于服务器端运行的编程语言，实现浏览器和网页服务器之间的数据交互。典型的PHP系统由Web服务器、PHP解释器和浏览器组成。
  1. **Web服务器**：PHP运行环境所在服务器。PHP支持多种服务器软件，包括Apache、IIS等。
  2. **PHP解释器**：实现对PHP程序的解释和编译。
  3. **浏览器**：浏览网页。由于PHP程序在发送到浏览器时已经被解释器编译成普通HTML代码，所以对浏览器没有限制。


> ### PHP基本语法

**纯PHP文件建议省略结束标记**。好处：在于防止结束标志后的空白字符输出。
<br>
PHP与HTML混编时，**先解析PHP代码**，剩余代码发给浏览器解析。

1. 注释

  ```markdown
  在PHP程序中添加注释的方法有3种，可以混合使用，具体方法如下：
  1. “//”：C++语言风格的单行注释
  2. “/* …… */”：C语言风格的多行注释
  3. “#”：UNIX的Shell语言风格的单行注释

  使用注释的注意事项：
  1. 注释不会影响程序的执行效率，因为注释在编译代码时会被忽略，因此不会被执行。
  2. 使用注释能够提高程序的可读性，也有利于后期维护工作。注释的语言描述必须准确、简洁。
  3. 实际项目开发中，程序代码与注释的比例一般为5：1。
  ```

2. 变量介绍

  - 变量的组成
    $开头，后面为变量名。
  - <font color="red">变量名的命名规则</font>
    - 由英文字母、数字、下划线等多个字符组成，**只能以字母或者下划线开头**。
    - **严格区分大小写**
    - 建议命名使用英文单词，见名知意
    - 变量名由多个单词组成：
      - **小驼峰法** （推荐）：第一个单词首字母小写，其余单词的首字母大写。(e.g. `$stuName` )
  - 可变变量：是一种特殊的变量，这种变量的名称由另一个变量来确定，也就是用一个变量的“值”作为另一个变量的“名”。声明可变变量的方法是在变量名称前加两个“$”符号。

    ```php
    // 语法：$$可变变量名称 = 可变变量的值
    $a = "php";
    $$a = "bbb";
    echo '变量$a的值'.$a;      // php
    echo '变量$$a的值'.$$a;    // bbb
    echo '变量$php的值'.$php;  // bbb
    ```

3. 变量操作

  - 变量声明
    - 一般声明与赋值同时进行。
    - 不需要单独指定变量的类型，变量的类型由值决定。
    - PHP本身为弱类型语言，值发生改变时类型自动变化。

  - 变量赋值
    - 直接赋值
    - 传值赋值
    - 引用赋值（传地址赋值）：`$b = & $a;`

  - 读取变量的值
    - 一般声明与赋值同时进行。
    - 变量必须先声明后使用，否则提示未定义变量“undefined variable”
    - <font color="red">输出时乱码解决</font>：`header("content-type:text/html;charset=utf-8");`

  - <font color="red">删除变量</font>
    - `unset($var);` 删除变量名及值之间的对应关系。变量名及变量值不会立即消失，PHP有专门的垃圾回收机制处理。


4. 常见的输出语句
  - **echo语句**
    - 输出**字符串、变量及表达式**
    - <font color="red">可以同时输出多个变量及字符串。</font>
    - 不是函数，**是语言结构**

  - **print语句**
    - 可以输出字符串、变量及表达式
    - 与echo语句的区别为：print<font color="red">不支持同时输出多个字符串及变量。</font>
    - 不是函数，**是语言结构**

  - **var_dump()**
    - **输出一个或者多个变量的类型，长度及值**。一般用于**打印复杂变量**（结合pre标记），如数组,对象等。

  - **print_r()**
    - **输出变量的值**。一般用于打印变量。对于字符串类型、整型、浮点型，打印变量本身。<font color="red">不能打印布尔类型的原始值</font>。对于复杂类型的变量，如数组、对象，按照一定的格式显示。
    - 打印的信息较var_dump()简单。
5. PHP标记

  - PHP代码可以嵌入HTML代码中使用，因此就需要使用PHP标记将PHP代码与HTML内容进行区分，当服务器读取该代码时，就会调用PHP编译程序进行编译处理。PHP支持4种标记风格，如下所示：

    - <font color="red">标准PHP标记风格（可移植性高，推荐使用）</font>

      ```php
      <? php
      	echo "这是标准PHP标记风格，也是最为普通的嵌入方式。使用该标记风格可以增加程序在跨平台使用时的通用度，因此建议使用该嵌入方式编写PHP代码";
      ?>
      ```

    - <font color="red">简短标记风格</font>

      ```php
      <?
      	echo "必须在php.ini文件中将short_open_tag选项设置为on";
      ?>
      ```

    - <font color="red">Script脚本标记风格</font>

      ```javascript
      <script language="php">
      	echo "Hello world";
      </script>
      ```

    - <font color="red">仿ASP标记风格</font>

      ```asp
      <%
      	echo "必须在php.ini文件中将asp_tags选项设置为on";
      %>
      ```

>### PHP的数据类型

1. **标量数据类型**（SCALAR）：整型(integer)、浮点型(float)、字符串(string)、布尔类型(bool)
  - 整数的表示形式：PHP的整型占据4个字节空间 ( `PHP_INT_SIZE` )，最大值为 `PHP_INT_MAX` (21亿多)。常用的是十进制数。每个字节对应8个二进制。

  - 浮点型（float,double）
    - 一般程序语言有单精度、双精度之分（精度为小数的位数）。<font color="red">PHP只实现了双精度</font>。
    - 可以使用科学计数法表示，如1e2 ,等于100，但是**类型是浮点型**
    - 运算中有浮点数参与运算，结果必然为浮点型。
    - **占据的空间为8字节**。能表示的最大值范围比整数大很多。整型范围无法表示的数字可以使用浮点型表示,以及超出整数表示范围，自动使用浮点数表示。
    - 浮点数转换为二进制部分数值为<font color="red">不精确表示</font>（进制转换小数部分的乘X取整，可能遇到无限不循环的情况）。由于内部表达方式的原因，比较两个浮点数是否相等是有问题的。(e.g. 0.1+0.2==0.3 ----> false)

  - 布尔类型
    - 表示事物的真或者假状态，分别对应true,false。一般用来做条件判断。
    - true及false不区分大小写(TRUE，FALSE)。建议小写，因为它不是常量。

  - 字符串型
    - 字符串是连续的字符序列，由数字、字母和符号组成。字符串中的每个字符只占用1B。另外，PHP中也提供一些转义字符，用来表示被程序语法结构占用了的特殊字符，例如：“\n”（换行符）、“\r”（回车符）、“\t”（Tab字符）等。在PHP中，可以使用单引号或双引号定义字符串。两者的不同之处在于：<font color="red">双引号中所包含的变量会自动被替换成实际变量值，而在单引号中包含的变量名称或者任何其他的文本都会不经修改地按普通字符串输出。</font>

2. **复杂数据类型**：数组(array)、对象(object)

3. **特殊数据类型**：null、资源型(resource)

  - <font color="red">为null的几种情况</font>：**尚未赋值**、**被赋值为null**、**被unset()函数销毁的变量**
  - resource：资源型，为第三方数据的引用（如成功的数据库连接、绘制图像创建画布、打开文件、打开文件夹等）。


>### 进制转换函数

  - **decimal**: 十进制  10
  - **binary**: 二进制  1010
  - **octect**: 八进制  0123
  - **hexadecimal**:十六进制 0x123

    ```php
    decbin(int 值)：十进制转二进制
    decoct(int 值): 十进制转八进制
    dechex(int 值): 十进制转16进制

    bindec(string 值): 二进制转十进制
    octdec(string 值)：八进制转十进制
    hexdec(string 值): 十六进制转十进制
    ```

>### isset()方法

  - <font color="red">变量未设置</font>或者<font color="red">设置为null</font>,**返回false**（认为变量没有设置）。其余情况全部为true。一般与if结合使用来判断变量是否设置。

>### empty()方法

  - 判断<font color="red">变量是否为空</font>。PHP中认为变量的值为：<font color="red">空字符串""、整型0、字符串"0"、NULL、布尔值false、空数组[]</font>时，变量虽然定义了，但是无实际的意义，为空。
  - <font color="red">变量没有定义</font>，empty判断也返回空。

>### 数据类型检测函数

- 用于查看某个类型

  | 函数名                                   | 功能说明               |
  | ------------------------------------- | ------------------ |
  | is_bool()                             | 检测变量或常量是否为布尔类型     |
  | is_string()                           | 检测变量或常量是否为字符串类型    |
  | is_float()/is_real()  \|  is_double() | 检测变量或常量是否为浮点类型     |
  | is_int()/is_long()  \|  is_integer()  | 检测变量或常量是否为整型       |
  | is_numeric()                          | 检测变量或常量是否为数字或数字字符串 |
  | is_null()                             | 检测变量或常量是否为空值       |
  | is_array()                            | 检测变量或常量是否为数组类型     |
  | is_object()                           | 检测变量或常量是否为对象类型     |
  | is_resource()                         | 检测变量或常量是否为资源类型     |
  | is_scalar()                           | 检测变量是否是一个标量        |
  | is_callable()                         | 检测参数是否为合法的可调用结构    |
  | is_nan()                              | 判断是否为合法数值          |

>### 类型转换

PHP变量属于松散的数据类型，在定义PHP变量时不需要指定数据类型，数据类型是由赋给变量或常量的值自动确定的。当不同数据类型的变量或常量之间进行运算时，需要先将变量或常量转换成相同的数据类型，再进行运算。PHP数据类型转换分为自动类型转换和强制类型转换。

  - <font color="blue">自动类型转换</font>：数据参与运算时，根据实际环境自动转换类型参与运算。

    - <font color="red">转换为布尔值为false</font>的情况
      - 整型0
      - 浮点型0.0
      - 字符串'0'
      - 空字符串''
      - 空数组[]
      - null

    - <font color="red">转换为数值类型</font>的原则
      - 当字符串转换为整型或浮点型时，如果字符是以数字开头的，就会先把数字部分转换为整型，再舍去后面的字符串，如果数字中含有小数点，则会取到小数点前一位。
      - 纯数字组成的字符串转换为相应的数字。 ‘123’→123
      - 可以转换为浮点型的字符，转换为相应的浮点数。 ‘123.1’→123.1
      - **以数字开头的字符串截取到非数字位**。  ‘14FE’→14　‘1e2aaaa’→100（浮点型）
      - **不以数字开头的字符串，转换为0**，包括字符串’true’。 “FE14”→ 0　'true'→0
      - 布尔值true转换为1，false转换为0。
      - 自动转换后**不改变原始变量**的数据类型，仅修改参与运算的类型。


  - <font color="blue">强制类型转换</font>：程序员通过编程手段强制将某变量或常量的数据类型转换成指定的数据类型。PHP提供了3种强制类型转换的方法。

    - 在变量前面加上一个小括号，然后把目标数据类型写在小括号中。示例：`$b = (int) $a;`
    - 使用通用类型转换函数 settype()。

      ```php
      // 语法格式：bool settype(变量名,"数据类型");
      settype($c,"int");  // 函数执行成功则返回true，否则返回false
      ```

    - 使用类型转换函数intval()、strval()、floatval()。示例：`$b = intval($a);`

  - <font color="blue">自动转换及强制转换的比较</font>

    - 转换之后，**原始数据类型不发生转换**，只是数据参与运算的值发生改变
    - 自动转换与强制转换的原则一致

>### 常量

  - 常量的定义

    - 脚本执行周期内，值不会发生改变的量。<font color="red">常量不可以修改及删除</font>。定义为常量可以节省存储空间。英文为：constant
    - 常量默认<font color="red">区分大小写</font>
    - 按照开发惯例，常量名推荐<font color="red">全部字母大写</font>
    - 常量<font color="red">不可以重复定义及修改数据</font>
    - 常量值为标量数据类型（整型、浮点型、布尔类型、字符串）
    - 不能在函数、流程控制（if、while）中定义常量。

      ```php
      // 语法1: define("常量名","常量值",大小写是否敏感);
      // “大小写是否敏感”为可选参数，指定是否大小写敏感，设定为true表示不敏感，默认为false（大小写敏感）
      define('VERSION'，'7.2.0');
      define('VERSION'，'7.2.1'); // Notice: Constant VERSION already defined 

      // 可以使用defined()函数判断常量是否已经被定义。
      // bool defined(常量名称);

      // 语法2: const 常量名 = 常量值;  // 与define定义的常量一样。
      const APP_DEBUG = false;
      ```

  - 常量在内存中的表示形式
    - 常量存放在<font color="red">常量区</font>，该区域的量<font color="red">不可以修改</font>。常量不可以重新定义及修改值。
    - 可以保证数据不被修改。常用来存储：版本号，路径等。

    | 常量名称        | 功能                                   |
    | ----------- | ------------------------------------ |
    | `__FILE__`  | 返回当前文件所在的完整路径和文件名（注：常量名前后分别是两个下画线符号） |
    | `__LINE__`  | 返回代码当前所在行数                           |
    | PHP_VERSION | 返回当前PHP程序的版本                         |
    | PHP_OS      | 返回PHP解释器所在操作系统名称                     |
    | TRUE        | 真值true                               |
    | FALSE       | 假值false                              |
    | NULL        | 空值null                               |
    | E_ERROR     | 指到最近的错误处                             |
    | E_WARNING   | 指到最近的警告处                             |
    | E_PARSE     | 指到解释语法有潜在问题处                         |
    | E_NOTICR    | 提示发生不寻常，但不一定是错误处（例如使用一个不存在的变量）       |

>### 运算符

  - **字符串连接运算符**：<font color="red">.</font>
    - 遇到比较长的字符串，可以先拼接再输出。PHP有专门的输出缓冲层（output buffer layer），只有缓冲区域的数据达到指定大小，才会输出。尽量使用字符串连接符，提升代码的执行效率。

  - 字符串分隔符：,
    - echo语句可以同时输出多个表达式，多个表达式之间使用英文的逗号分隔。建议使用字符串连接符。

  - **错误抑制符**：@ （抑制错误提示）
  - 取余运算符：%
    - <font color="red">取余结果的符号取决于被除数的符号</font>。与被除数的符号一致，与除数的符号无关。
  - **运算符优先级**：算术运算符 > 比较运算符 > 逻辑运算符 > 赋值运算符

>### 流程控制

  - die()方法
    - 退出代码执行，当前位置之后的所有代码不执行。可以用来进行程序运行控制，可以在出错的时候执行此语句，退出代码的执行。<font color="red">可以在退出时输出变量值、完成函数执行</font>。(e.g. `die([…]);` )

  - exit()方法与die()方法一样

  - sleep()方法
    - 执行到sleep所在的语句后，延缓一定的秒数，继续执行。可以查看一些临时数据。

>### 函数

  - 声明语法

    ```php
    function 函数名（[参数1，参数2]）{
        函数体；
        //return 语句；
    }
    ```

  - 五要素
    - function关键字。
    - 函数名
    - 参数列表，可选。
    - 函数体：函数功能的核心代码。
    - 返回值，可选。通过return语句实现将数据返回到调用的地方。不能返回多个值，但可以通过返回一个数组来实现

  - 调用函数
    - 遵循**先声明后调用**。实际上，**调用的位置可以在声明位置之前**，不违背先声明后调用的原则。PHP执行的第一阶段为预编译，将函数代码存放在代码区，执行阶段，使用函数名调用函数。

  - 参数传递
    - 值传递：将实际参数的值复制到对应的形式参数中，然后使用形式参数在被调用函数内部进行运行，运算的结果不会影响到实际参数，即**函数调用结束后，实际参数的值不会发生改变**。
    - 引用传递（按地址传递）：将实际参数的内存地址传递到形式参数中。此时被调用函数内形式参数的值若发生改变，则实际参数也发生相应改变，引用传递的语法格式有两种。

      ```php
      // 1. 定义函数时，在形式参数前面加上 & 符号
      function 函数名(& $str1, & $str2, ...){...} //定义函数
      函数名($a1, $a2, ...);                      //调用函数

      // 2. 调用函数时，在实际参数前面加上 & 符号
      function 函数名($str1, $str2, ...){...}     //定义函数
      函数名(& $a1, & $a2, ...);                  //调用函数
      ```

    - 默认参数（可选参数）：在定义函数时可以指定某个参数为可选参数，将可选参数放在参数列表末尾，并且指定其默认值。

  - <font color="red">函数名命名规则</font>
    - 函数名由字母数字下划线组成，<font color="red">且只能以字母开头，不能由下划线和数字开头，不能使用点号和中文字符</font>。对于较长的函数名可以使用下划线命名法。
    - 函数不能重新定义，不能使用系统函数名。
    - **不区分大小写**（变量名区分大小写 ，常量名默认区分大小写）

>### PHP支持的作用域及特点

  - <font color="red">函数外部定义的变量，在函数内部无法使用</font>。在函数内部定义的变量，在函数外部无法使用。

  - **全局作用域**：在函数外部定义的变量为全局作用域内的变量，称为全局变量，其作用域是整个PHP文件，即从定义变量的语句开始到文件末尾，但在函数内无效。如果要在函数内部访问全局变量，要使用global关键词声明，其语法格式如下：

    ```php
    global $变量名;
    ```

  - **局部作用域**：在函数内部定义的变量称为局部变量。变量在函数内部可以使用，外部不可以使用，在函数调用结束后被系统自动回收。

  - 全局作用域与局部作用域的关系：<font color="red">全局作用域与局部作用域没有交集</font>。不同函数的作用域，也没有交集。

  - **静态变量**：无论是全局变量还是局部变量，在调用结束后，该变量值将会失效。但有时仍然需要该变量，此时就需要将该变量声明为静态变量，声明静态变量只需要在变量前加static关键字即可，语法格式如下：

    ```php
    static $变量名 = 变量值;
    ```

  - <font color="red">超全局变量</font>
    - $GLOBALS是专门用来实现数据的超全局化的超全局变量。
    - 作用：引用全局作用域中的全部全局变量。
    - 创建一个全局变量，系统会<font color="red">自动在$GLOBALS中创建变量名为下标的元素</font>。
    - 在$GLOBALS中添加元素，自动创建相应名字的全局变量。
    - 删除或者修改$GLOBALS数组的元素，会导致全局变量同步修改或删除。

>### PHP标准函数库

  1. PHP变量函数库

    | 函数        | 说明        |
    | --------- | --------- |
    | empty()   | 检测变量是否为空  |
    | isset()   | 检测变量是否被赋值 |
    | unset()   | 销毁变量      |
    | gettype() | 获取变量类型    |

  2. 字符串函数库

    | 函数            | 说明                      |
    | ------------- | ----------------------- |
    | explode()     | 使用一个字符串分割另一个字符串         |
    | implode()     | 合并数组元素到一个字符串            |
    | trim()        | 删除字符串左右侧的连续空白           |
    | str_replace() | 字符串替换                   |
    | **md5()**     | **用md5算法对字符串进行加密**      |
    | strlen()      | 获取指定字符串的长度（所占字节数）       |
    | substr()      | 大字符串中从指定位置开始截取一定长度的子字符串 |
    | strtolower()  | 将字符串中的字符全部变为小写          |
    | strtoupper()  | 将字符串中的字符全部变为大写          |

  3. 日期时间函数库

    | 函数                                       | 说明                |
    | ---------------------------------------- | ----------------- |
    | checkdate()                              | 验证日期的有效性          |
    | date()                                   | 格式化一个本地时间或日期      |
    | time()                                   | 返回当前的unix时间戳      |
    | date_default_timezone_set("Asia/Shanghai") | 设定用于所有日期时间函数的默认时区 |

  4. PHP数学函数库

    | 函数                 | 说明                                       |
    | ------------------ | ---------------------------------------- |
    | rand() / mt_rand() | 产生一个随机数，可以取到两端的值。**mt_rand生成的速度比rand快四倍多**。 |
    | max()              | 比较最大值                                    |
    | min                | 比较最小值                                    |
    | abs()              | 返回绝对值                                    |
    | ceil()             | 进一法取整                                    |
    | floor              | 舍去法取值                                    |
    | round()            | 四舍五入取整                                   |

  5. PHP文件目录函数库

    | 函数                    | 说明                                       |
    | --------------------- | ---------------------------------------- |
    | copy()                | 复制文件到其他目录                                |
    | file_exists()         | 判断指定的目录或文件是否存在                           |
    | basename()            | 返回路径中的文件名部分                              |
    | file_put_contents     | 将字符串写入到指定的文件中                            |
    | file()                | 把整个文件读入数组中，数组各元素值对应文件的各行                 |
    | fopen()               | 打开本地或远程的某文件，返回该文件的标志指针                   |
    | fread()               | 从文件指针所指文件中读取指定长度的数据                      |
    | fclose()              | 关闭一个已打开的文件指针                             |
    | is_dir                | 如果参数为目录路径且该目录存在，则返回true，否则返回false        |
    | mkdir()               | 新建一个目录                                   |
    | move_uploaded_file()  | 应用post方法上传文件                             |
    | readfile()            | 读取一个文件，将读取的内容写入到输出缓存                     |
    | rmdir($dirname)       | 尝试删除 dirname 所指定的目录。**该目录必须是空的**，而且要有相应的权限。成功返回true，否则返回false |
    | **unlink($filename)** | 删除指定文件，成功返回true，否则返回false。<font color="red">删除的文件名包含中文时需要先使用iconv()方法转码后再删除。</font> |
    | disk_free_space()     | 返回指定目录的可用空间                              |
    | filetype()            | 获取文件类型                                   |
    | filesize()            | 获取文件大小                                   |

>### 系统函数

  - <font color="red">时间日期函数</font>
    - time()：返回自从 Unix 纪元（格林威治时间 1970 年 1 月 1 日 00:00:00）到当前时间的**秒数**，即时间戳，为**10位整型数字**。通常用于保存文章的发布时间、商品的发布时间等。

    - date()：时间戳为整型数字，无法直接使用，需要先使用date函数**格式化时间戳**。

      ```php
      // 文章发布时间在数据库中最好保存为int类型的时间戳，显示时间时使用date()方法将时间戳转化为日期
      // 返回将整数（时间戳） timestamp 按照给定的格式字串而产生的字符串。如果没有给出时间戳则使用本地当前时间。换句话说，timestamp 是可选的，默认值为 time()。
      string date ( string $format [, int $timestamp ] )
      // e.g date('Y/m/d',time());
      ```

    - strtotime()：将任何英文文本的日期时间描述解析为 Unix 时间戳。

      ```php
      // int strtotime ( string $time [, int $now = time() ] )
      // 本函数预期接受一个包含美国英语日期格式的字符串并尝试将其解析为 Unix 时间戳，其值相对于 now 参数给出的时间，如果没有提供此参数则用系统当前时间。 
      strtotime("now"), "\n";
      strtotime("10 September 2000"), "\n";
      strtotime("+1 day"), "\n";
      strtotime("+1 week"), "\n";
      strtotime("+1 week 2 days 4 hours 2 seconds"), "\n";
      strtotime("next Thursday"), "\n";
      strtotime("last Monday"), "\n";
      ```

>### PHP文件写入

  - <font color="red">fopen()函数</font>：打开一个文件或者 URL

    ```php
    fopen ( filename , mode )
    // filename：要打开的文件路径
    // mode: 指定了所要求到该流的访问类型
    // mode 的可能值
      // 'r' 只读方式打开，将文件指针指向文件头
      // 'r+' 读写方式打开，将文件指针指向文件头
      // 'w' 以写入方式打开文件，**并将文件清空**，如果文件不存在则创建该文件
      // 'w+' 以读写方式打开文件，并将文件清空，如果文件不存在则创建该文件
      // 'a' 以写入方式打开文件，将文件指针指向文件末尾，如果文件不存在则创建该文件
      // 'a+' 以读写方式打开文件，将文件指针指向文件末尾，如果文件不存在则创建该文件
    // 成功时返回文件指针资源，如果打开失败，本函数返回 FALSE
    $handle = fopen("c:\\folder\\resource.txt", "w");
    ```

  - <font color="red">fwrite()函数</font>：将字符串写入文件资源

    ```php
    fwrite ( handle , string [, length ] )
    // handle：打开的文件资源
    // string: 要写入的字符串
    // length: 如果指定了 length，当写入了 length 个字节或者写完了 string 以后，写入就会停止
    // 返回写入的字符数，出现错误时则返回 FALSE
    fwrite ( $handle , 'string' );
    ```

  - file_get_contents()函数：读取文件内容

    ```php
    file_get_contents ( filename );
    ```

  - file_put_contents()函数：将一个字符串写入文件

    ```php
    file_put_contents ( filename , data );
    // data：要写入的数据。类型可以是 string，array 或者是 stream 资源
    ```

>### 位运算实现数字加密和解密

  - 加密解密函数如下：

    ```php
    // 自定义加密函数
    function Encrypt($num){
        return $num = $num >> 888999;  // 向左移位，移位方法和密钥（888999）是自己设定的
    }
    // 自定义解密函数
    function Descrypt($num){
        return $num = $num << 888999;
    }
    ```

>### 包含语句

  - 不同的页面中有相同的代码部分，可以将其分离为单个文件（导航栏、footer）。需要调用时，引入对应的文件即可调用，提高代码的复用率。
  - <font color="red">include()函数</font>包含文件时，**只有程序执行到该语句时才将文件包含进来**，当所包含文件发生错误时，系统**只给出警告，继续执行**。当多次调用相同文件时，程序会多次包含文件。
  - <font color="red">include_once()函数</font>与include()函数几乎相同，唯一区别在于，当多次调用相同文件时，程序**只包含文件一次**。
  - <font color="red">require()函数</font>包含文件时，**程序一开始运行时就将所需调用的文件包含进来**，当所包含文件发生错误时，系统**输出错误信息并立即终止程序执行**。
  - <font color="red">require_once()函数</font>与require()函数几乎相同，唯一区别在于，当多次调用相同文件时，程序只包含文件一次。

>###路径问题

  - 魔术常量：`__DIR__` （自动获取当前执行脚本的目录）
  - getcwd() ：成功则返回当前工作目录，失败返回 FALSE。 
  - `__FILE__ `： 当前内容写在哪个文件就显示这个文件目录+文件名

>###字符串

1. 常见的字符串定义语法
  - 单引号
    - <font color="red">不解析变量</font>
    - 单引号中包含单引号需要转义
    - 单引号中可以包含双引号

  - 双引号
    - <font color="red">可以解析变量</font>
    - **双引号中包含双引号，需要转义**
    - 变量最好使用**变量边界符号{}**
    - 单引号与双引号嵌套的问题：**只有最外层是双引号时，才能解析变量**

  - heredoc字符串定义结构
    - 单引号及双引号，在多行字符串、复杂字符串（如JS代码）的定义时显得不便。
    - <font color="red">heredoc语法结构</font>

      ```php
      $str =<<<heredoc标记名
          字符串内容
      heredoc标记名;
      ```

    - 注意事项：
      - 以<<<开头，其后跟着自定义的标识符。在换行的位置，开始字符串的书写。
      - 字符串输入完成后，换行输入原先自定义的标识符。（标识符必须为本行第一列。）
      - 自定义标识符的命名遵循PHP命名规范。**两处的标识符必须一致**。
      - <font color="red">可以解析变量。单引号及双引号不需要转义或者处理</font>。一般用于保存较长字符串或者JS代码等。



2. 字符串长度问题
  - 计算字符串长度的函数`strlen()`
    - 返回的是单字节字符串的字节数（等于字符数）。多字节字符返回对应单字节的长度，即字节数。

  - 多字节字符串长度问题
    - GBK字符集中，一个汉字字符占2个字节，一个英文字符占1个字节。
    - UTF-8字符集中，一个汉字字符占3个字节，一个英文字符占1个字节。

  - 计算多字节（multiple bytes）字符串的字符数
    - PHP提供多字节字符串扩展模块php_mbstring.dll。在PHP.ini中开启多字节扩展模块php_mbstring.dll后就可以使用`mb_strlen()`来统计多字节字符串的字符长度。

      ```php
      // 字符编码省略时，使用单字节编码计算。
      // mb_strlen(字符串，使用的字符集);
      mb_strlen($str，"utf8");
      ```


>### 字符串相关函数
1. 字符串输出函数`printf()`
  - 依据 format 格式参数产生输出。

    ```php
    // 占位符：%d:十进制有符号整数  %s:字符串。参数列表与占位符一一对应
    // printf ( string $format [, mixed $args [, mixed $... ]] )
    $age =18;
    $major ="PHP";
    printf("苍老师今年%d岁，专业为%s",$age,$major); // 苍老师今年18岁，专业为PHP
    ```

2. 字符串替换与重复
  - `str_replace()`方法，该函数返回一个字符串或者数组。该字符串或数组是将 subject 中全部的 search 都被 replace 替换之后的结果。

    ```php
    // str_replace ( mixed $search , mixed $replace , mixed $subject )
    $str ="PHP是世界上最好的语言";
    $str =str_replace("PHP", "JS", $str);
    echo $str; // JS是世界上最好的语言
    ```

  - `str_repeat()`方法

    ```php
    // string str_repeat ( string $input , int $multiplier )
    // 返回 input 重复 multiplier 次后的结果
    str_repeat("&nbsp;",10);
    ```

3. **大小写转换函数**
  - `strtolower()`方法

    ```php
    string strtolower ( string $string ) // 将 string 中所有的字母字符转换为小写并返回。
    ```

  - `strtoupper()`方法

    ```php
    string strtoupper ( string $string ) // 将 string 中所有的字母字符转换为大写并返回。
    ```

  - `ucfirst()`方法

    ```php
    string ucfirst(string $str) // 将 str 的首字符（如果首字符是字母）转换为大写字母并返回。
    ```

4. 去除空白函数
  - `trim()`,`ltrim()`,`rtrim()`

    ```php
    // trim — 去除字符串首尾处的空白字符（或者其他字符）
    string trim ( string $str [, string $charlist = " \t\n\r\0\x0B" ] )
    ```

5. 数组与字符串转换函数
  - `explode()`方法

    ```php
    // 将目标字符串使用分割符分割，返回子字符串组成的数组。
    explode(分隔符,目标字符串);
    ```

  - `implode()`方法

    ```php
    // 将数组的元素使用连接字符串拼接成新的字符串
    implode(连接的字符,数组);
    ```

  - `str_split()`方法

    ```php
    // 将字符串分成指定长度（默认为1字节）的子字字符串，返回数组。
    str_split($str,1);  // 英文字符的分割
    str_split($str,3);  // 中文字符的分割
    ```

6. 位置查找函数
  - `strpos()`方法

    ```php
    // 查找子字符串在目标字符串中首次出现的位置。从左侧开始查找。下标从0开始
    strpos(目标字符串,要查找的子字符串);
    ```

  - `strrpos()`方法

    ```php
    // 查找子字符串在目标字符串中首次出现的位置。从右侧开始查找。下标从0开始
    strrpos(目标字符串,要查找的子字符串);
    ```

7. 截取子字符串函数
  - `substr()`方法

    ```php
    // 在一个字符串中从指定位置起截取一定长度的子字符串，并返回子字符串。省略第三个参数，直接截取到末尾
    substr(目标字符串,起始下标[,截取长度]);
    // 如果起始位置为正数，将得到从起点开始，截取指定长度的字符子串
    // 如果起始位置为负数，将得到原字符串尾部的一个子串，截取长度为给定负数的绝对值。
    $a = "一二三四五六七八九十";
    $b1 = substr($a,2);    // 二三四五六七八九十
    $b2 = substr($a,2,4);  // 二三
    $b3 = substr($a,-4);   // 九十    起始位置是负数，是起始位置，也是长度
    $b4 = substr($a,-4,8); // 九十    起始位置是负数，本身的绝对值就是长度，不能再设置截取长度
    ```

  - `strchr()`方法 、`strrchr()`方法

    ```php
    // 从左侧，自字符串出现的位置截取到末尾
    strchr(目标字符串,截取的起始子字符串);
    // 从右侧，自字符串出现的位置截取到末尾
    strrchr(目标字符串,截取的起始子字符串);
    ```

8. 字符串转义问题
  - 单引号与双引号在特殊场合需要通过添加\实现转义。**转义字符必须包含在双引号之中，才能被正确解析**。
  - 单引号不能识别转义符，双引号及heredoc可以识别。
  - **转义字符一般用于文件系统**，浏览器不能解析转义符。

>###数组

数组是内存中一块连续的空间（堆区）。用来保存不同类型的数据。数据没有长度限制。

1. 创建数组的两种方式
  - 显式创建
    - 下标可以为数字，也可以为字符。PHP5.4支持数组的短标记方式[]

      ```php
      $arr1 = ['李白','新疆',38];
      $arr2 = array('李白','新疆',38);
      $arr = array("key1" => "value1", "key2" => "value2");
      ```

  - 隐式创建
    - 不使用array关键字，直接向数组中添加元素

      ```php
      // 枚举数组（索引数组）
      // 部分元素省略下标时，新增的元素的下标，在原来下标的最大值基础上增长。
      $info[] ='小米6';
      $info[] =2499.9;
      $info[4] ="手机";
      $info[]  ='包邮';

      $pc['goodsName'] = "Macbook Air";
      $pc['price']     = 8999;
      $pc['CPU']       = 'i7';

      // 混合数组
      // 显示时，与元素的添加顺序有关，与下标的排序无关
      $students =[
      	1        =>'山东蓝翔技校',
      	'name'   =>'张三',
      	'age'    =>48,
      	'哈弗学院',
      	'major'  =>'大数据挖掘机专业'
      ];
      ```

>###数组遍历foreach

1. 语法

  ```php
  // $key可以自行命名，该位置的变量表示某个元素的下标
  // $value可以自行命名，该位置的变量表示某个元素的值
  foreach($arr as [$key =>] $value){
      //循环体
  }
  ```

2. 遍历数组

  - 数组中存在指针。数组的遍历是靠操作指针实现的。
  - 遍历时，获取当前指针指向的元素的键及值，分别赋值给变量`$key` 及`$value`。然后移动指针一次。<font color="red">获取最后一个元素后，指针移动，指针非法，循环自动终止。</font>

>### 数组常用函数

数组中存在指针，创建一个数组时，指针默认指向数组的第一个元素。foreach遍历时，自动移动指针，指向下一个元素，即可获取不同元素的值及键名。
1. `key($arr)`
  - 获取当前指针指向元素的键名。

2. `current($arr)`
  - 获取当前指针指向元素的键值。

3. `next($arr)`
  - 指针移动一次，指向下一个元素。

4. `reset($arr)`
  - 指针复位。指针指向数组的第一个元素。

5. `max()`、`min()`
  - 可以返回数组元素中最大值及最小值。

6. `count（$arr）`
  - 统计数组元素的个数。

7. `in_array()`
  - 查找目标数组中是否存在该元素。字符串元素的比较时，区分大小写。

    ```php
    in_array(目标元素，目标数组);
    ```

8. `range()`
  - 返回位于起始元素及终止元素之间值所组成的新数组

    ```php
    range(起始元素,终止元素[,步长=1]);
    ```

9. `array_merge()`
  - 合并多个数组。关联数组合并时，若元素下标相同，后面的数组的元素会覆盖前面的。索引数组不覆盖。

    ```php
    array_merge($arr1,$arr2);
    ```

10. `array_rand()`
  - 随机返回目标数组中指定个数的键名，以数组的形式返回。

    ```php
    array_rand(目标数组，键的个数);
    ```

11. `shuffle()`
   - **打乱数组**，增加数组元素的随机性。

     ```php
     shuffle($arr);
     ```

12. `array_unique()`
   - 删除数组中重复元素，并返回删除重复元素后的数组

13. `array_push()`
   - 向数组中添加元素，并返回数组新的元素个数

     ```php
     int array_push($数组名称, 元素值1, 元素值2, ...);
     // 元素值1为要添加的元素值，格式可以是“键名 => 元素值”，也可以是“元素值”。可以一次添加多个元素值
     ```

14. `array_pop()`
   - 获取并删除数组最后元素，如果操作对象的数组为空或不是数组，将返回null。

     ```php
     元素值类型 array_pop($数组名称);
     // “元素值类型”为数组元素的类型，如数组元素为字符串，则值为"string"
     ```

15. 键值相关函数
   - `array_keys()`
     - 返回数组中元素的键名组成的数组。
   - `array_values()`
     - 返回数组中所有元素的值组成的索引数组。

16. 数组**排序函数**
   - `sort($arr);`
     - 对数组元素进行升序排序，重建数字索引。
   - `asort($arr);`
     - 对数组元素进行升序排序，保持索引。
   - `rsort($arr);`
     - 对数组元素进行降序排列，重建索引。(r,reverse,逆向)
   - `arsort($arr);`
     - 对数组元素进行降序排列，保持索引。
   - `ksort($arr);`
     - 按照键名（key）升序排序，主要用于关联数组。保存数组的索引。
   - `krsort($arr);`
     - 按照键名降序排序，主要用于关联数组。保存数组的索引。

   - 总结

   |  函数   | sort | asort | rsort | arsort | ksort | krsort |
   | :---: | :--: | :---: | :---: | :----: | :---: | :----: |
   | 按下标/值 |  值   |   值   |   值   |   值    |  下标   |   下标   |
   | 升序/降序 |  升序  |  升序   |  降序   |   降序   |  升序   |   降序   |
   | 索引保持  |  N   |   Y   |   N   |   Y    |   Y   |   Y    |

>###表单值传递

浏览器向WEB服务器提交数据的方式主要有两种：GET和POST。
1. GET方式
  - 表单方式：form 表单的method属性设置为GET。表单的每个元素**name属性值必须填写**，否则该元素的值不提交。

  - 链接方式：
    - **html的a标记**：将“请求”数据以查询字符串的方式附在URL之后提交数据。问号“？”表示查询字符串的开始，问号后面的字符串参数为查询字符串。每个参数以“参数名=参数值”的格式定义，参数之间使用“&”相连。
    - **location.href属性**：location为JS对象。每个对象有属性、方法。JS跳转传递参数的本质还是在URL中包含参数。`location.href ="请求的地址?a=100&b=200"`
    - **location.assign()方法**：本质为函数，实现特定的功能。`location.assign(url);`
    - **header的location与refresh选项**

      ```php
      header("location:新的地址");
      // refresh在等待指定的秒数期间，继续输出后续的信息，时间到，它就跳。
      header("refresh:秒数;url=新的地址"); //注意 :号 与 =号
      ```

  - **GET方式提交数据的特点**：
    - 查询字符串中不允许有空格字符存在。
    - 参数值不需要使用单双引号包括。
    - 通过查询字符串传递的数据量不能太大，数据上限一般为2kb。
    - 由于通过查询字符串传递的信息会显示在浏览器的地址栏中，因此这种方式不能保证数据的安全性。

2. POST方式
  - 表单的method必须设置为POST。各个表单元素的name属性必填，name属性值作为$_POST数组元素的下标使用。
  - **POST方式提交数据的特点**：
    - POST数据提交方式比GET提交方式安全。因此诸如用户注册、登录等系统，不建议使用GET提交方式。
    - POST方式提交数据上限默认为8M（可以在PHP的配置文件post_max_size选项中修改），可以提交更多的数据。理论上讲，POST提交方式提交的数据没有大小限制。

>###PHP接收数据的三种方式

GET方式、POST方式提交的数据分别存放在`$_GET`、`$_POST`数组中。`$_GET`与`$_POST`数组都是系统预定义变量。
  - 常见的预定义变量（变量名几乎是以’$_’开头，后半部分为全大写，都是数组。）
    - `$_SERVER`:存储服务器环境信息以及HTTP协议相关信息。
    - `$_GET`: 用户GET方式提交的数据。
    - `$_POST`: 用户POST方式提交的数据。
    - `$_FILES`: 上传的文件信息（包括文件名、文件类型、大小）
    - `$_REQUEST`: GET、POST、COOKIE数据。
    - `$_COOKIE`: 保存COOKIE数据（保存在浏览器端的用户隐私数据）。
    - `$_SESSION`: 保存SESSION数据（保存在服务器端的用户隐私数据）。
    - `$GLOBALS`: 引用所有的全局变量数据。可以用来解决函数使用变量时的作用域问题。
  - `$_REQUEST`
    - 表单提交数据方式设置为POST方式后，通过action属性设置的提交方式仍为GET方式。
    - `$_REQUEST` =`$_GET` + `$_POST` +`$_COOKIE`。在默认的PHP.ini中不将COOKIE数据放在该数组中，需要配置。
    - <font color="red">所有通过表单或者地址栏提交的数据都是字符串类型。</font>

>###文件上传

1. 表单注意事项
  - form 表单数据的编码类型由**enctype**决定，默认为application/x-www-form-urlencoded方式编码。文件上传时属性值必须设置为<font color="red">multipart/form-data</font>。
  - 数据提交方式：POST方式
  - 文件域：`<input type="file" name="属性值" />`

2. $_FILES数组
  - 文件上传后，文件信息自动保存在预定义变量`$_FILES`数组中。假设myFile为文件域的name属性值。
    - `$_FILES['myFile']['name']` <font color="blue">上传文件的文件名</font>
    - `$_FILES['myFile']['tmp_name']`
      - <font color="blue">文件的临时路径</font>，默认为c:/windows/temp。没有直接将文件上传至Apache服务器的根目录：用户的数据是不安全的。
      - 临时文件保存路径可以在PHP.ini中upload_tmp_dir选项进行设置。
      - 临时文件的查看方法：使用sleep函数，休眠代码的执行。
    - `$_FILES['myFile']['type']` <font color="blue">文件的MIME类型</font>
      - MIME(Multipurpose Internet Mail Extensions) 是描述消息内容类型的因特网标准。MIME 消息能包含文本、图像、音频、视频以及其他应用程序专用的数据。不同的系统支持不同的MIME类型。
      - 常见的文件类型：image/jpeg,image/png,image/gif,text/html，text/javascript

    - `$_FILES['myFile']['error']` <font color="blue">文件上传的状态代码</font>，其<font color="red">取值及对应的意义</font>如下：
      - 0：没有错误发生，文件上传成功。
      - 1：上传的文件超过了 php.ini 中 upload_max_filesize 选项（默认为2M）限制的值（超过2M,不超过8M）。
      - 2：上传文件的大小超过了FORM表单中MAX_FILE_SIZE参数指定的值。
        - 可以通过`<input type="hidden" name="MAX_FILE_SIZE" value="30000" />`实现浏览器对文件大小的初步判断，避免过大文件不必要的上传造成的浪费时间。此隐藏域必须在文件域之前设置。
      - 3：文件只有部分被上传。
      - 4：表单没有选择上传文件。
      - 6：找不到临时文件夹。

    - `$_FILES['myFile']['size']` <font color="blue">文件的大小</font>（单位为byte，字节）
    - **注意事项**：
      - 超出POST_MAX_SIZE时，数组$_FILES为空，此时无错误代码提示。
      - 超过UPLOAD_MAX_FILESIZE时，但是没有超过8M，$_FILES中可以查看error信息。

3. <font color="blue">**文件上传的步骤**</font>（完整代码见my_php_functions.php）
  - 判断`$_FILES`是否为空（当上传的文件超过POST_MAX_SIZE时，会发生致命错误，此时$_FILES为空）

    ```php
    if(empty($_FILES)){
        die('发生未知错误');
    }
    ```

  - 判断错误：`$_FILES['myFile']['error']` 出错提示错误信息

  - 判断文件是否是HTTP POST上传的文件：`is_uploaded_file($_FILES['myFile']['tmp_name']);`

  - **判断文件类型**：不能通过上传后的扩展名来判断文件的类型，只能通过MIME类型。
    - 获取文件MIME类型步骤（利用<font color="red">php_fileinfo.dll</font>对MIME类型进行严格检查）
      - 在php.ini开启php_fileinfo.dll扩展：`extension=php_fileinfo.dll`
      - 打开fileinfo资源：`$fileInfo = finfo_open(FILEINFO_MIME_TYPE);` 该函数执行后，执行成功返回资源型，失败返回false。
      - 读取上传文件的MIME类型：`$mime = finfo_file($fileInfo,$_FILES['myFile']['tmp_name']);`
      - 定义网站支持的MIME类型：`$mimeArr = ['image/jpeg','image/png'];`
      - 判断MIME类型是否在数组中存在：`if(!in_array($mime,$mimeArr)){die('文件类型不支持')}`

  - 判断永久保存目录是否存在 `is_dir ( 永久保存目录 )`

  - 永久保存目录不存在则新建目录

    ```php
    bool mkdir ( string $pathname [, int $mode = 0777 [, bool $recursive = false [, resource $context ]]] );
    // pathname 目录的路径
    // mode 默认的 mode 是 0777，意味着最大可能的访问权
    // recursive Allows the creation of nested directories specified in the pathname.
    // context PHP 在 5.0.0 中增加了对上下文（Context）的支持
    // 成功时返回 TRUE， 或者在失败时返回 FALSE
    ```

  - 对保存的文件名进行转码（Windows系统文件编码格式为GB2312/GBK） `iconv ( 'utf-8' , 'gbk' , 永久路径 )`
  - 移动到网站永久路径：`move_uploaded_file($_FILES['myFile']['tmp_name'],永久路径);`

4. <font color="red">pathinfo()方法</font>

  - 返回文件路径的信息

    ```php
    // 语法：pathinfo ( string $path [, int $options = PATHINFO_DIRNAME | PATHINFO_BASENAME | PATHINFO_EXTENSION | PATHINFO_FILENAME ] )
    // 返回一个关联数组包含有 path 的信息。返回关联数组还是字符串取决于 options
    // path 要解析的路径
    // options 如果指定了，将会返回指定元素，如果没有指定 options 默认是返回全部的单元。 
    <?php 
    $tmp = pathinfo("./ajax/verifyCode.php");
    echo "<pre>";
    print_r($tmp);
    /*
    Array
    (
        [dirname] => ./ajax
        [basename] => verifyCode.php
        [extension] => php
        [filename] => verifyCode
    )
    */
    //文件上传处理
    $upfile = '';
    if($_FILES['myFile']['error'] == 0){
        //将上传文件拆解成后缀和用户名
    	$tmp = pathinfo($_FILES['myFile']['name']);
    	//重新组装上传后的文件名
    	$filename = md5($tmp['filename'].time()).'.'.$tmp['extension'];
    	//定义要保存到数据表中的路径信息
    	$upfile = "/admin/uploads/$filename";
    	//上传文件到本地目录
    	move_uploaded_file($_FILES['myFile']['tmp_name'],"../uploads/$filename");
    }
    ```

>###访问数据库

1. PHP的MySQL数据库扩展
  - 开启MySQL数据库扩展
    - 在php.ini中查PHP扩展路径：`extension_dir ="ext"`
    - 加载扩展模块：`extension =php_mysql.dll`

2. PHP与命令行操作数据库的区别
  - **命令行操作数据库**设置的字符集（<font color="red">命令行只支持GBK</font>）：`set names gbk;`
  - **PHP操作数据库**设置的字符集（<font color="red">php编码为UTF8</font>）：`set names utf8;`

3. 连接数据库服务器
  - 语法：

    ```php
    // 成功时，返回资源型的数据库连接。失败返回false
    // 资源型：是一种特殊变量，保存了到外部资源的一个引用(PHP操作的数据)。资源是通过专门的函数来建立和使用的。
    mysql_connect("主机名[:端口号]","用户名","密码");
    ```

  - <font color="blue">**连接数据库函数封装**</font>

    ```php
    <?php 
    /**
     * [$dbConf 数据库连接的配置参数]
     * @var string host    [主机名]
     * @var string user    [用户名]
     * @var string pwd     [密码]
     * @var string db      [数据库名]
     * @var string charset [字符集编码]
     */
    $dbConf = [
    	"host" => "localhost:3306",
    	"user" => "root",
    	"pwd" => "root",
    	"db" => "dbname",
    	"charset" => "utf8"
    ];
    /**
     * [dbconn 数据库连接]
     * @param  array  $conf    [配置参数数组]
     * @return resource $conn  [建立的连接]
     */
    function dbconn($conf = []){
    	$conn = mysql_connect($conf["host"],$conf["user"],$conf["pwd"]);
    	if(!$conn){
    		die("数据库连接失败，错误信息:".mysql_error());
    	}
    	mysql_select_db($conf["db"],$conn) or die("数据库选择失败，错误信息:".mysql_error());
    	mysql_query("set names ".$conf["charset"]) or die("无效的字符集，错误信息:".mysql_error());
    	return $conn;
    }
    $conn = dbconn($dbConf);
    ```

>###增删改注意事项

  - 使用PHP发送SQL语句前，可以先打印SQL语句，检查语句的正确性
  - 使用变量拼接SQL语句时，字段为字符串类型，需要在变量的两侧使用单、双引号包裹。可以将所有的字段外面都使用双引号包含。

>###查询操作

  - 查询语句执行成功,返回资源型resource（结果集），失败为false。

  - 失败的情况

    ```php
    $sql = "select * from `tb_name`";
    $res = mysql_query($sql);
    // !$res 查询失败
    // mysql_num_rows($res) == 0 查询不到内容，返回空结果集，但是返回的类型是资源型
    if(!$res || mysql_num_rows($res) == 0){
        die('暂无数据');
    }
    ```

  - <font color="red">解析结果集的三种方式</font>
    1. `mysql_fetch_array(resource $res);`
      - 返回结果集中的一行，以**混合数组形式**返回。<font color="red">既有数字下标，又有字符下标</font>。
      - 使用查询字段的名称作为字符下标。
      - 函数的参数必须为查询结果集。
      - 每次执行移动一次指针，返回一行数据。
    2. `mysql_fetch_row($res);`
      - <font color="red">返回索引数组</font>。
    3. `mysql_fetch_assoc($res);`
      - <font color="red">返回关联数组</font>，元素下标为查询字段的名称。
    4. 三个函数的相同点
      - 每次执行，以数组的形式取出结果集中的一行，并且将指针向下移动一次。当指针非法时，返回false。

  - <font color="red">遍历结果集</font>
    - 使用while循环获取每一行

      ```php
      // 1 读取结果集的一行
      // 2 赋值给$line，指针移动一次
      // 3 使用$line进行条件判断
      // 最后一次执行时返回false
      while($line = mysql_fetch_assoc($res)){
          $rows[] = $line;
      }
      ```

    - 以foreach混编的方式遍历输出内容

      ```php
      <?php foreach($rows as $v):?>
      	<tr align="center">
              <td><?php echo $v['id']?></td>
      	</tr>
      <?php endforeach;?>
      ```

>###HTTP响应行常见错误代码

  - 格式：`协议版本 状态码 状态描述（HTTP/1.1 200 OK）` 通知浏览器请求资源的返回结果状态。

    | **状态码** |       **状态描述**        | **意义**  |
    | :-----: | :-------------------: | :-----: |
    |   200   |          ok           |  请求成功   |
    |   302   |    Found\|Redirect    |   重定向   |
    |   403   |       Forbidden       |  禁止访问   |
    |   404   |       Not Found       |  未找到资源  |
    |   500   | Internal Server Error | 服务器内部错误 |

>###会话技术分类

  - 按照数据持久化的位置进行区分
    - 数据持久化存储在**服务器**，为**session技术**
    - 数据持久化存储在**浏览器**，为**cookie技术**

>###设置cookie

  - 设置语法：

    ```php
    setcookie('名称','值','有效期','有效路径','有效域名');
    // 有效期：默认会话周期。在浏览器窗口关闭之前，一直存在，关闭后立即消失。好处是减少空间占用，减少HTTP传输的数据量，提高数据安全。
    // time() -1 清除COOKIE数据
    // 有效路径：默认当前目录及子目录有效。设置整站有效: /
    // 有效域名：默认当前域名。实现跨子域：.domain

    setcookie('cookiename','value','lifetime','path','.domain');
    // 设置有效期为一周
    setcookie('cookiename','value',time() + 3600 * 24 *7,'/','.domain');
    // 设置永久有效
    setcookie('cookiename','value',PHP_INT_MAX,'/','.domain');
    ```

  - 删除cookie：

    ```php
    // 没有显式的删除函数。可以通过设置COOKIE数据为空字符串来实现。COOKIE数据为空后，浏览器自动消除该数据空间。
    setcookie('cookiename','');
    // 方式二
    setcookie('cookiename','',time() - 1);
    ```

>###SESSION会话技术

1. 开启session机制

  ```php
  // 开启session会话或者重用已经创建的会话
  session_start();
  // session文件的默认保存路径session.save_path：/tmp
  // 查看session文件的方法：在windows的临时路径tmp中，以sess开头的文件
  ```

2. 删除一个session数据

  ```php
  $_SESSION['key'] = null;
  // 可以使用unset语法删除一个session数据（数组的一个元素）。删除的是session文件中的指定数据，不删除session文件
  // unset($_SESSION['key']);

  // 使用session_unset()可删除当前内存中$_SESSION数组中的所有元素，但不能删除对应的session ID，也不能删除保存session ID的文件。而session_destroy()函数能删除session ID，并销毁session文件，但它不会删除内存中$_SESSION数组中的所有元素。
  // session_unset();

  // session对象有一个有效期，默认24分钟(1440秒)。如果客户端超过24分钟没有刷新网页或访问网站中的其他网页，则该session对象就会自动结束。
  // 可以修改session对象的默认有效期：
  // 1) php.ini中修改：session.gc_maxlifetime=1440;
  // 2) 利用ini.set()方法更改Session对象的默认有效期
  ```

3. 删除所有session信息

  ```php
  // $_SESSION设置为空数组。本质为使用空数组覆盖session文件中对应的数据。session文件不被删除
  $_SESSION = [];
  ```

4. 销毁session信息

  ```php
  // 直接删除session会话文件，PHP脚本将无法读取session数据
  session_destroy();
  ```

>### SESSION配置选项

1. **session.name**
  - 设置SESSION依赖的COOKIE中，COOKIE数据的名称。PHP脚本将当前会话的名称（session文件的名称）返回给COOKIE，默认保存在对应的COOKIE PHPSESSID中。

2. **session.cookie_lifetime**
  - 按照cookie信息（浏览器的身份信息），读取服务器端的相应的session文件的信息。session.cookie_lifetime=0,意味着COOKIE数据的生命周期为会话周期，关闭浏览器，COOKIE数据消失，无法使用浏览器的身份信息查到session信息。但是session暂时还是存在的。

3. **session.cookie_path**
  - session所使用的COOKIE的有效路径。

4. **session.cookie_domain**
  - session所使用的COOKIE的有效域名。默认为：当前站点有效。

>###session与COOKIE之间的区别与联系

1. 区别

  - **从存储位置**：COOKIE存储在浏览器，SESSION存储的服务器端。
  - **数据安全性**：session存储在服务器端，不易获取，更加安全。
  - **传输的数据量**：每次请求，COOKIE传输量较大。传递该网站相关的全部的COOKIE数据。
  - **支持的数据类型**：COOKIE支持字符串，SESSION支持几乎所有的数据类型。

2. 联系

  - 都是用来解决HTTP协议的无状态、无记忆的不足之处，以实现业务的连续性，如登录及购物车模块的实现。
  - 二者都是会话技术的范畴 。
  - SESSION需要依赖COOKIE（浏览器的身份信息）进行数据的传递。禁用COOKIE后，session无法正常使用（确保类似于使用同一个购物车：将来可以在不同的页面之间传递SESSION会话的名字，session_id()）。

>###面向对象技术

1. 面向对象程序设计（Object-Oriented Programming, OOP）是目前主流的编程思想之一。面向对象的编程思想就是将要处理的实际问题抽象为一个个对象，通过设置各个对象的属性和行为来解决该对象的实际问题。类和对象是面向对象编程的基础。

  - 类

    - 面向对象的一个重要理念就是世间万物皆为对象，将具有相同或相似属性的对象归为一类。世间万物都具有自身的特征（属性）和行为（方法），通过这些属性和方法可以将不同物质（对象）区分开来，形成类。也就是说，**类是属性和方法的集合**。

  - 对象

    - 类只是某一类具有相同特征（属性）的事物（对象）的抽象模型，实际应用中还需要对类进行具体化（实例化），对象是类进行实例化后的产物，它是一个实体。

2. 类和对象

  - 类的定义

    ```php
    // PHP支持面向对象的编程，类的定义使用class关键字来标识，语法格式如下
    <?php
    	访问修饰符 class 类名{
        	// 类体
        	访问修饰符 $属性名1;
        	访问修饰符 $属性名2;
      		访问修饰符 function 方法名1(){// 方法体1}
    		访问修饰符 function 方法名2(){// 方法体2}
    	}
    ?>
    // 访问修饰符：用于控制类的可访问性，取值范围为：public、protected、private等
    // 类名：类的名称，命名规则与变量相同
    // 类体：在此处编写类的成员，包括类的属性和方法等
    // 类的属性：在类中声明的变量，可以使用访问修饰符控制类属性的访问范围
    // 类的方法：在类中声明的函数，声明方法和声明函数的语法相同，但是可以使用访问修饰符控制类方法的访问范围
    ```

  - 对象
    - 创建对象：对象是类的实例，类创建完后，就可以创建相应的对象。创建对象通常也称为类的实例化，语法格式如下：

      ```php
      $对象名 = new 类名([参数1,...]);
      ```

    - 访问对象成员：在对象中使用“<font color="red">-></font>”运算符访问类中声明的成员属性和方法，语法格式如下：

      ```php
      $对象名 -> 成员属性1 = 值1;  // 为成员属性赋值
      $对象名 -> 成员属性1;        // 获取成员属性值
      $对象名 -> 成员方法;         // 调用对象中指定的方法
      ```

  - 构造方法和析构方法
    - <font color="red">构造方法</font>
      - 当为某类实例化一个对象时，有时需要对这个对象进行一些初始化操作，而不是等对象创建完成后再逐个赋值，这时就用到构造方法（构造函数）。<font color="red">类在被实例化时会自动调用构造方法，用于初始化对象</font>。该方法必须命名为`__construct`，**它没有返回值，可以没有参数，也可以有多个参数**，语法格式如下：

        ```php
        // 构造函数中的“__”是两条下划线“_”
        void __construct([参数1,...]){
            方法体;
        }
        ```

    - <font color="red">析构方法</font>
      - 析构方法的作用和构造方法正好相反，<font color="red">对象在被销毁时会自动调用析构方法，用于释放内存</font>。析构方法必须命名为`__destruct`，**它没有参数和返回值**，语法格式如下：

        ```php
        void __destruct([参数1,...]){
            方法体;
        }
        ```

3. 面向对象程序设计的特点

  - <font color="red">继承性</font>
    - 继承是指一个类（子类）继承于另一个类（父类），子类自动拥有父类的相关属性和方法（private修饰的属性和方法不能被继承），子类还可以根据需要声明自己的属性和方法。**通过继承能够提高代码的重用性和可维护性**。继承分为单继承和多继承。<font color="red">PHP仅支持单继承，即一个子类只能有一个父类</font>。类的继承的语法格式如下：

      ```php
      class 子类名称 extends 父类名称{
          // 子类成员变量列表
      }
      ```

  - <font color="red">多态性</font>
    - 多态性是指一个类的同一个方法，在不同对象中执行结果不同。多态性增加了软件的灵活性和重用性。多态性包括两种形式：**覆盖和重载**。
      - 所谓覆盖就是在子类中重写父类的方法，当子类中的成员与父类成员重名时，子类中的成员覆盖掉父类中的成员。
      - 重载是类的多态的另一种实现。**方法重载是指一个类中存在多个同名函数，这些函数虽然有相同的函数名，但参数个数或参数类型不相同，因此能够通过函数的参数个数或者参数类型将这些同名函数区分开来**。调用时，虽然函数名称相同，但系统将根据参数个数或者参数类型不同自动调用对应的函数，不会发生混淆。但是**PHP对重载的支持并不理想**，甚至可以说PHP根本不支持真正的重载，因为**PHP不允许一个类中出现两个同名的变量或者同名的方法**，否则会报错。

  - <font color="red">封装性</font>
    - 封装性是将类的实现和使用分开,将数据(存储在属性中)与方法封装在一起,只通过方法存取数据。对于需要用到该类数据的程序员，只需要知道该类的方法如何调用，并不需要了解该类的内部结构。这样可以控制数据的存取方式，解决数据存取的权限问题。类的封装是通过访问修饰符进行控制的。常用访问修饰符如下：
      - <font color="red">public（公共成员）</font>：public修饰符是允许的最高访问级别，由它所修饰的类、属性以及方法对外公开，可以在程序的任何地方调用。
      - <font color="red">private（私有成员）</font>：private是一种私有访问修饰符，是允许的最低访问级别，**由它所修饰的类、属性及方法完全隐藏，只能在本类中被调用，而且不可以在子类和其他类中被调用**。
      - <font color="red">protected（保护成员）</font>：protected用于修饰类的成员，用protected修饰的类成员，**在本类和子类中能够被调用，在其它类中不可以被调用**。
      - <font color="red">static（静态成员）</font>：static可以用于修饰类的属性和方法，用static修饰的类成员（包括属性和方法，分别称为静态属性和静态方法）使用时不需要实例化类，可以通过类名进行调用。静态属性和方法与对象的创建和销毁操作无关，即**静态成员创建于程序开始运行，销毁于程序结束**。

        ```php
        // 在类的内部访问静态成员的语法格式如下：
        self::$成员名称

        // 在在类的外部访问该类静态成员的语法格式如下：
        类名::$成员名称
        ```

      - <font color="red">final（最终）</font>：final可用于修饰类或方法，**用final修饰的类不可以被继承**（即不能有子类）。**用final修饰的方法在子类中不可以被覆盖**。

>###PHP安全与加密技术

PHP安全漏洞种类很多，常见的有文件上传漏洞、表单提交漏洞和SQL注入漏洞等。

  - PHP数据加密技术
    - <font color="red">crypt()数据加密函数</font>

      ```php
      // crypt()函数没有相应的解密函数，使用一种单向算法。语法格式如下：
      string crypt(string 原字符串);
      // 经crypt()函数加密后的字符串是随机产生的
      ```

    - <font color="red">sha1()数据加密函数</font>

      ```php
      // sha1()函数使用的是SHA(Secure Hash Algorithm)，它是一种安全哈希算法。语法格式如下：
      string sha1(string 原字符串);
      // 函数名sha后面的1是阿拉伯数字1
      ```

    - <font color="red">md5()数据加密函数</font>

      ```php
      // md5()函数使用信息摘要算法第5版(Message-Digest Algorithm 5)算法，用于将一个字符串经过运算生成一个128位的整数值。语法格式如下：
      string md5(string 原字符串);
      ```

  - 表单提交数据处理
    - <font color="red">htmlspecialchars() 函数</font>：把预定义的字符转换为 HTML 实体。预定义的字符是：
      - & （和号）成为 &
      - " （双引号）成为 "
      - ' （单引号）成为 '
      - < （小于）成为 <
      - \> （大于）成为 >
      - <font color="orange">**提示：**</font>如需把特殊的 HTML 实体转换回字符，请使用 htmlspecialchars_decode() 函数。

    - <font color="red">addslashes() 函数</font>：返回在预定义字符之前添加反斜杠的字符串。预定义字符是：

      - 单引号（'）
      - 双引号（"）
      - 反斜杠（\）
      - NULL
      - <font color="orange">**提示：**</font>该函数可用于为存储在数据库中的字符串以及数据库查询语句准备字符串。
      - **注释：**默认地，PHP 对所有的 GET、POST 和 COOKIE 数据自动运行 addslashes()。所以您不应对已转义过的字符串使用 addslashes()，因为这样会导致双层转义。遇到这种情况时可以使用函数 get_magic_quotes_gpc() 进行检测。

        ```php
        <?php
        // 如果启用了魔术引号
        echo $_POST['lastname'];             // O\'reilly
        echo addslashes($_POST['lastname']); // O\\\'reilly

        // 适用各个 PHP 版本的用法
        // 如果 magic_quotes_gpc 为关闭时返回 0，否则返回 1。在 PHP 5.4.0 起将始终返回 FALSE 
        if (get_magic_quotes_gpc()) {
            $lastname = stripslashes($_POST['lastname']);
        }
        else {
            $lastname = $_POST['lastname'];
        }

        // 如果使用 MySQL
        $lastname = mysql_real_escape_string($lastname);

        echo $lastname; // O\'reilly
        $sql = "INSERT INTO lastnames (lastname) VALUES ('$lastname')";
        ?> 
        ```

    - <font color="red">获取ID时对ID值进行强制类型转换：</font>`$id = intval($_GET['id']);`

    - <font color="red">SQL语句中变量加引号：</font>`SELECT * FROM tbname WHERE name = '$name';`

<div style="width:800px;text-align:center;">
Copyright© 2017 <a style="text-decoration: none;color: #FF0066;" href="https://github.com/kingmui" target="_blank">KINGMUI</a> All Rights Reserved<br />Updated on October 06, 2017
</div>